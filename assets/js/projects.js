const projects = [
  {
    id: "gradeko",
    category: "Product Design",
    title: "GradeKo",
    description: "A platform for parents to connect with teachers and follow student progress in real time.",
    subtitle: "A platform for parents to connect with teachers.",
    details:
      "GradeKo grading System is a comprehensive platform designed to help students, teachers, administrators, and parents efficiently manage and track grades. It provides real-time access to students' performance, allowing all users to monitor grades throughout the term and track final grades seamlessly.",
    tags: ["HTML", "CSS", "JavaScript", "PHP", "MYSQL"],
    timeline: "November 2025",
    role: "Mobile & Web",
    image: "/GradeKo/Login.png?auto=format&fit=crop&w=1200&q=80",
    gallery: [
      "/GradeKo/1.png?auto=format&fit=crop&w=1400&q=80",
      "/GradeKo/2.png?auto=format&fit=crop&w=1400&q=80",
      "/GradeKo/3.png?auto=format&fit=crop&w=1400&q=80",
      "/GradeKo/4.png?auto=format&fit=crop&w=1400&q=80",
      "/GradeKo/5.png?auto=format&fit=crop&w=1400&q=80",
      "/GradeKo/6.png?auto=format&fit=crop&w=1400&q=80",
      "/GradeKo/7.png?auto=format&fit=crop&w=1400&q=80",
      "/GradeKo/8.png?auto=format&fit=crop&w=1400&q=80",
      "/GradeKo/9.png?auto=format&fit=crop&w=1400&q=80",
      "/GradeKo/10.png?auto=format&fit=crop&w=1400&q=80",
    ],
    link: "https://nadhir.dev/projects/edulink",
  },
  {
    id: "cargo",
    category: "Productivity",
    title: "Car-Go",
    description:
      "Car-go is a streamlined car rental platform that simplifies bookings, payments, and due date management for a hassle-free experience.",
    subtitle: "An inspiration library powered by collaborative bookmarking.",
    details:
      "Car-go is an innovative car rental system designed to streamline transactions for both customers and owners, offering a seamless online experience with secure payment options and hassle-free due date management.",
    tags: ["HTML", "CSS", "JavaScript", "PHP", "MYSQL"],
    timeline: "October 2025",
    role: "Web Application",
    image: "/CarGo/HeroSection.png?auto=format&fit=crop&w=1200&q=80",
    gallery: [
      "/CarGo/1.png?auto=format&fit=crop&w=1400&q=80",
      "/CarGo/2.png?auto=format&fit=crop&w=1400&q=80",
      "/CarGo/3.png?auto=format&fit=crop&w=1400&q=80",
      "/CarGo/4.png?auto=format&fit=crop&w=1400&q=80",
      "/CarGo/5.png?auto=format&fit=crop&w=1400&q=80",
      "/CarGo/6.png?auto=format&fit=crop&w=1400&q=80",
      "/CarGo/7.png?auto=format&fit=crop&w=1400&q=80",
      "/CarGo/8.png?auto=format&fit=crop&w=1400&q=80",
      "/CarGo/9.png?auto=format&fit=crop&w=1400&q=80",
      "/CarGo/10.png?auto=format&fit=crop&w=1400&q=80",
      "/CarGo/11.png?auto=format&fit=crop&w=1400&q=80",
      "/CarGo/12.png?auto=format&fit=crop&w=1400&q=80",
      "/CarGo/13.png?auto=format&fit=crop&w=1400&q=80",
      "/CarGo/14.png?auto=format&fit=crop&w=1400&q=80",
    ],
    link: "https://nadhir.dev/projects/flowy",
  },
  {
    id: "equiptrack",
    category: "DevOps",
    title: "EquipTrack",
    description: "Blueprints and scripts to spin up Docker and Kubernetes clusters on any cloud in minutes.",
    subtitle: "Infrastructure playbooks for container-first teams.",
    details:
      "EquipTrack is a robust system designed to manage and record school equipment, allowing users to efficiently track the availability, condition, and usage of various resources. It streamlines the process of monitoring equipment, ensuring proper allocation and timely maintenance.",
    tags: ["Flutterflow", "Dart", "Firebase"],
    timeline: "March 2025",
    role: "Mobile & Web",
    image: "EquipTrack/Login.png?auto=format&fit=crop&w=1200&q=80",
    gallery: [
      "EquipTrack/1.png?auto=format&fit=crop&w=1400&q=80",
      "EquipTrack/2.png?auto=format&fit=crop&w=1400&q=80",
      "EquipTrack/3.png?auto=format&fit=crop&w=1400&q=80",
      "EquipTrack/4.png?auto=format&fit=crop&w=1400&q=80",
      "EquipTrack/5.png?auto=format&fit=crop&w=1400&q=80",
      "EquipTrack/6.png?auto=format&fit=crop&w=1400&q=80",
      "EquipTrack/7.png?auto=format&fit=crop&w=1400&q=80",
      "EquipTrack/8.png?auto=format&fit=crop&w=1400&q=80",
    ],
    link: "https://nadhir.dev/projects/deploy-kit",
  },
  {
    id: "mindlink",
    category: "Platform",
    title: "MindLink",
    description: "A dashboard that unifies developer bookmarks, tracking tools, and documentation.",
    subtitle: "A personal control hub for high-output developers.",
    details:
      "MindLink is an innovative student helper app designed to support learners by providing personalized study tools, resources, and real-time assistance. It offers features like task management, study reminders, and interactive learning aids, empowering students to enhance their productivity and academic success.",
    tags: ["HTML", "CSS", "JavaScript", "PHP", "MYSQL"],
    timeline: "October 2025",
    role: "Mobile & Web",
    image: "MindLink/Login.png?auto=format&fit=crop&w=1200&q=80",
    gallery: [
      "MindLink/1.png?auto=format&fit=crop&w=1400&q=80",
      "MindLink/2.png?auto=format&fit=crop&w=1400&q=80",
      "MindLink/3.png?auto=format&fit=crop&w=1400&q=80",
      "MindLink/4.png?auto=format&fit=crop&w=1400&q=80",
      "MindLink/5.png?auto=format&fit=crop&w=1400&q=80",
      "MindLink/6.png?auto=format&fit=crop&w=1400&q=80",
      "MindLink/7.png?auto=format&fit=crop&w=1400&q=80",
      "MindLink/8.png?auto=format&fit=crop&w=1400&q=80",
      "MindLink/9.png?auto=format&fit=crop&w=1400&q=80",
    ],
    link: "https://nadhir.dev/projects/atlas",
  },
  {
    id: "reneweco",
    category: "Platform",
    title: "RenewEco",
    description: "A dashboard that unifies developer bookmarks, tracking tools, and documentation.",
    subtitle: "A personal control hub for high-output developers.",
    details:
      "Renew Eco is a specialized system designed to assist municipalities and cities in scheduling waste collection and efficiently tracking customer information. It streamlines garbage management, ensuring timely pickups and providing real-time tracking for improved service delivery and customer satisfaction.",
    tags: ["Flutterflow", "Dart", "Firebase"],
    timeline: "March 2025",
    role: "Mobile & Web",
    image: "RenewEco/Login.png?auto=format&fit=crop&w=1200&q=80",
    gallery: [
      "RenewEco/1.png?auto=format&fit=crop&w=1400&q=80",
      "RenewEco/2.png?auto=format&fit=crop&w=1400&q=80",
      "RenewEco/3.png?auto=format&fit=crop&w=1400&q=80",
      "RenewEco/4.png?auto=format&fit=crop&w=1400&q=80",
      "RenewEco/5.png?auto=format&fit=crop&w=1400&q=80",
      "RenewEco/6.png?auto=format&fit=crop&w=1400&q=80",
    ],
    link: "https://nadhir.dev/projects/atlas",
  },
  {
    id: "styleTransfer",
    category: "Platform",
    title: "NeuralStyleTransfer",
    description: "A dashboard that unifies developer bookmarks, tracking tools, and documentation.",
    subtitle: "A personal control hub for high-output developers.",
    details:
      "Mobile-based Real-Time Neural Style Transfer is an innovative system that leverages advanced neural networks to apply artistic styles to images in real time. With seamless mobile integration, users can instantly transform their photos into unique artworks, enhancing creativity on the go.",
    tags: ["Flutterflow", "Dart", "Firebase"],
    timeline: "March 2025",
    role: "Mobile Development",
    image: "StyleTransfer/mosaic.png?auto=format&fit=crop&w=1200&q=80",
    gallery: [
      "StyleTransfer/1.png??auto=format&fit=crop&w=1400&q=80",
      "StyleTransfer/2.png??auto=format&fit=crop&w=1400&q=80",
      "StyleTransfer/3.png??auto=format&fit=crop&w=1400&q=80",
      "StyleTransfer/4.png??auto=format&fit=crop&w=1400&q=80",
      "StyleTransfer/5.png??auto=format&fit=crop&w=1400&q=80",
      "StyleTransfer/6.png??auto=format&fit=crop&w=1400&q=80",
      "StyleTransfer/7.png??auto=format&fit=crop&w=1400&q=80",
    ],
    link: "https://nadhir.dev/projects/atlas",
  },
];

function assetPath(path) {
  if (/^https?:\/\//i.test(path)) return path;
  const noQuery = path.split("?")[0];
  const trimmed = noQuery.replace(/^\/+/, "").replace(/\?\?/g, "?");
  if (trimmed.startsWith("public/")) return `./${trimmed}`;
  return `./public/${trimmed}`;
}

function elFromHTML(html) {
  const template = document.createElement("template");
  template.innerHTML = html.trim();
  return template.content.firstElementChild;
}

function renderProjectsGrid() {
  const grid = document.getElementById("projectsGrid");
  if (!grid) return;

  projects.forEach((project) => {
    const card = elFromHTML(`
      <div class="col-12 col-md-6">
        <button type="button" class="project-card w-100 text-start p-0" data-project-id="${project.id}">
          <div class="project-card-media">
            <img src="${assetPath(project.image)}" alt="${project.title} preview" loading="lazy" />
            <div class="project-card-over">
              <p class="text-white-60 small font-mono text-uppercase tracking-wide mb-2">${project.category}</p>
              <h3 class="h4 font-mono fw-bold text-white mb-2">${project.title}</h3>
              <p class="text-white-80 small mb-0">${project.description}</p>
            </div>
          </div>
          <div class="project-card-body">
            <div class="d-flex flex-wrap gap-2 mb-3">
              ${project.tags.map((tag) => `<span class="tag-pill">${tag}</span>`).join("")}
            </div>
            <div class="d-flex align-items-center gap-2 text-white-60 small font-mono">
              <span>${project.timeline}</span>
              <span class="mx-1" aria-hidden="true">â€¢</span>
              <span>${project.role}</span>
            </div>
          </div>
        </button>
      </div>
    `);

    grid.appendChild(card);
  });
}

function setModalProject(project) {
  const modalEl = document.getElementById("projectModal");
  if (!modalEl) return;

  document.getElementById("projectModalCategory").textContent = project.category;
  document.getElementById("projectModalLabel").textContent = project.title;
  document.getElementById("projectModalSubtitle").textContent = project.subtitle;
  document.getElementById("projectModalTimeline").textContent = project.timeline;
  document.getElementById("projectModalRole").textContent = project.role;
  document.getElementById("projectModalDetails").textContent = project.details;

  const tagsWrap = document.getElementById("projectModalTags");
  tagsWrap.innerHTML = project.tags.map((tag) => `<span class="tag-pill">${tag}</span>`).join("");

  const linkWrap = document.getElementById("projectModalLinkWrap");
  const linkEl = document.getElementById("projectModalLink");
  if (project.link) {
    linkWrap.classList.remove("d-none");
    linkEl.href = project.link;
  } else {
    linkWrap.classList.add("d-none");
    linkEl.href = "#";
  }

  const slides = (project.gallery?.length ? project.gallery : [project.image]).map(assetPath);
  const inner = document.getElementById("projectCarouselInner");
  const indicators = document.getElementById("projectCarouselIndicators");
  const prevBtn = document.getElementById("projectCarouselPrev");
  const nextBtn = document.getElementById("projectCarouselNext");
  inner.innerHTML = "";
  if (indicators) indicators.innerHTML = "";

  slides.forEach((src, idx) => {
    const item = elFromHTML(`
      <div class="carousel-item ${idx === 0 ? "active" : ""}">
        <button type="button" class="carousel-zoom-btn" data-zoom-index="${idx}" aria-label="Zoom image ${idx + 1}">
          <img src="${src}" alt="${project.title} screen ${idx + 1}" loading="lazy" />
        </button>
      </div>
    `);
    inner.appendChild(item);
  });

  const carouselEl = document.getElementById("projectCarousel");
  const carousel = bootstrap.Carousel.getOrCreateInstance(carouselEl, {
    interval: false,
    ride: false,
    touch: true,
    keyboard: true,
  });
  carousel.to(0);

  if (indicators) {
    slides.forEach((_, idx) => {
      const button = document.createElement("button");
      button.type = "button";
      button.setAttribute("aria-label", `Slide ${idx + 1}`);
      if (idx === 0) {
        button.classList.add("active");
        button.setAttribute("aria-current", "true");
      }
      button.addEventListener("click", () => carousel.to(idx));
      indicators.appendChild(button);
    });
  }

  const updateIndicators = (activeIndex) => {
    if (!indicators) return;
    Array.from(indicators.querySelectorAll("button")).forEach((btn, idx) => {
      btn.classList.toggle("active", idx === activeIndex);
      if (idx === activeIndex) btn.setAttribute("aria-current", "true");
      else btn.removeAttribute("aria-current");
    });
  };

  if (carouselEl.__onSlide) {
    carouselEl.removeEventListener("slid.bs.carousel", carouselEl.__onSlide);
  }
  carouselEl.__onSlide = (event) => updateIndicators(event.to ?? 0);
  carouselEl.addEventListener("slid.bs.carousel", carouselEl.__onSlide);

  if (prevBtn) prevBtn.onclick = () => carousel.prev();
  if (nextBtn) nextBtn.onclick = () => carousel.next();

  inner.querySelectorAll("[data-zoom-index]").forEach((btn) => {
    btn.addEventListener("click", () => openZoomModal(slides, Number(btn.getAttribute("data-zoom-index") || 0)));
  });
}

function openZoomModal(slides, startIndex) {
  const modalEl = document.getElementById("zoomModal");
  const inner = document.getElementById("zoomCarouselInner");
  const indicators = document.getElementById("zoomCarouselIndicators");
  const prevBtn = document.getElementById("zoomCarouselPrev");
  const nextBtn = document.getElementById("zoomCarouselNext");
  inner.innerHTML = "";
  if (indicators) indicators.innerHTML = "";

  slides.forEach((src, idx) => {
    const item = elFromHTML(`
      <div class="carousel-item ${idx === startIndex ? "active" : ""}">
        <div class="d-flex justify-content-center align-items-center bg-black rounded-4 p-2">
          <img src="${src}" alt="Zoomed project visual" class="w-100" style="max-height: 70vh; object-fit: contain; border-radius: 1rem;" />
        </div>
      </div>
    `);
    inner.appendChild(item);
  });

  const carouselEl = document.getElementById("zoomCarousel");
  const carousel = bootstrap.Carousel.getOrCreateInstance(carouselEl, {
    interval: false,
    ride: false,
    touch: true,
    keyboard: true,
  });
  carousel.to(startIndex);

  if (indicators) {
    slides.forEach((_, idx) => {
      const button = document.createElement("button");
      button.type = "button";
      button.setAttribute("aria-label", `Slide ${idx + 1}`);
      if (idx === startIndex) {
        button.classList.add("active");
        button.setAttribute("aria-current", "true");
      }
      button.addEventListener("click", () => carousel.to(idx));
      indicators.appendChild(button);
    });
  }

  const updateIndicators = (activeIndex) => {
    if (!indicators) return;
    Array.from(indicators.querySelectorAll("button")).forEach((btn, idx) => {
      btn.classList.toggle("active", idx === activeIndex);
      if (idx === activeIndex) btn.setAttribute("aria-current", "true");
      else btn.removeAttribute("aria-current");
    });
  };

  if (carouselEl.__onSlide) {
    carouselEl.removeEventListener("slid.bs.carousel", carouselEl.__onSlide);
  }
  carouselEl.__onSlide = (event) => updateIndicators(event.to ?? startIndex);
  carouselEl.addEventListener("slid.bs.carousel", carouselEl.__onSlide);

  if (prevBtn) prevBtn.onclick = () => carousel.prev();
  if (nextBtn) nextBtn.onclick = () => carousel.next();

  const modal = bootstrap.Modal.getOrCreateInstance(modalEl);
  modal.show();
}

function setupProjectClicks() {
  document.addEventListener("click", (event) => {
    const button = event.target.closest("[data-project-id]");
    if (!button) return;
    const project = projects.find((p) => p.id === button.getAttribute("data-project-id"));
    if (!project) return;

    setModalProject(project);
    const modal = bootstrap.Modal.getOrCreateInstance(document.getElementById("projectModal"));
    modal.show();
  });
}

document.addEventListener("DOMContentLoaded", () => {
  renderProjectsGrid();
  setupProjectClicks();
});
