const projects = [
  {
    id: "gradeko",
    category: "Platform",
    title: "GradeKo",
    description: "A platform for parents to connect with teachers and follow student progress in real time.",
    subtitle: "A platform for student and parents to connect with teachers.",
    details:
      "GradeKo grading System is a comprehensive platform designed to help students, teachers, administrators, and parents efficiently manage and track grades. It provides real-time access to students' performance, allowing all users to monitor grades throughout the term and track final grades seamlessly.",
    tags: ["HTML", "CSS", "JavaScript", "PHP", "MYSQL"],
    timeline: "November 2025",
    role: "Mobile & Web",
    image: "/GradeKo/Login.png?auto=format&fit=crop&w=1200&q=80",
    gallery: [
      "/GradeKo/1.png?auto=format&fit=crop&w=1400&q=80",
      "/GradeKo/2.png?auto=format&fit=crop&w=1400&q=80",
      "/GradeKo/3.png?auto=format&fit=crop&w=1400&q=80",
      "/GradeKo/4.png?auto=format&fit=crop&w=1400&q=80",
      "/GradeKo/5.png?auto=format&fit=crop&w=1400&q=80",
      "/GradeKo/6.png?auto=format&fit=crop&w=1400&q=80",
      "/GradeKo/7.png?auto=format&fit=crop&w=1400&q=80",
      "/GradeKo/8.png?auto=format&fit=crop&w=1400&q=80",
      "/GradeKo/9.png?auto=format&fit=crop&w=1400&q=80",
      "/GradeKo/10.png?auto=format&fit=crop&w=1400&q=80",
    ],
    link: "https://nadhir.dev/projects/edulink",
  },
  {
    id: "cargo",
    category: "Platform",
    title: "Car-Go",
    description:
      "Car-go is a streamlined car rental platform that simplifies bookings, payments, and due date management for a hassle-free experience.",
    subtitle: "A plaform to easily booked cars.",
    details:
      "Car-go is an innovative car rental system designed to streamline transactions for both customers and owners, offering a seamless online experience with secure payment options and hassle-free due date management.",
    tags: ["HTML", "CSS", "JavaScript", "PHP", "MYSQL"],
    timeline: "October 2025",
    role: "Web Application",
    image: "/CarGo/HeroSection.png?auto=format&fit=crop&w=1200&q=80",
    gallery: [
      "/CarGo/1.png?auto=format&fit=crop&w=1400&q=80",
      "/CarGo/2.png?auto=format&fit=crop&w=1400&q=80",
      "/CarGo/3.png?auto=format&fit=crop&w=1400&q=80",
      "/CarGo/4.png?auto=format&fit=crop&w=1400&q=80",
      "/CarGo/5.png?auto=format&fit=crop&w=1400&q=80",
      "/CarGo/6.png?auto=format&fit=crop&w=1400&q=80",
      "/CarGo/7.png?auto=format&fit=crop&w=1400&q=80",
      "/CarGo/8.png?auto=format&fit=crop&w=1400&q=80",
      "/CarGo/9.png?auto=format&fit=crop&w=1400&q=80",
      "/CarGo/10.png?auto=format&fit=crop&w=1400&q=80",
      "/CarGo/11.png?auto=format&fit=crop&w=1400&q=80",
      "/CarGo/12.png?auto=format&fit=crop&w=1400&q=80",
      "/CarGo/13.png?auto=format&fit=crop&w=1400&q=80",
      "/CarGo/14.png?auto=format&fit=crop&w=1400&q=80",
    ],
    link: "https://nadhir.dev/projects/flowy",
  },
  {
    id: "equiptrack",
    category: "Platform",
    title: "EquipTrack",
    description: "A mobile and web-based system that simplifies tracking, monitoring, and managing school equipment in real time.",
    subtitle: "Smart equipment tracking for efficient school resource management.",
    details:
      "EquipTrack is a robust system designed to manage and record school equipment, allowing users to efficiently track the availability, condition, and usage of various resources. It streamlines the process of monitoring equipment, ensuring proper allocation and timely maintenance.",
    tags: ["Flutterflow", "Dart", "Firebase"],
    timeline: "March 2025",
    role: "Mobile & Web",
    image: "EquipTrack/Login.png?auto=format&fit=crop&w=1200&q=80",
    gallery: [
      "EquipTrack/1.png?auto=format&fit=crop&w=1400&q=80",
      "EquipTrack/2.png?auto=format&fit=crop&w=1400&q=80",
      "EquipTrack/3.png?auto=format&fit=crop&w=1400&q=80",
      "EquipTrack/4.png?auto=format&fit=crop&w=1400&q=80",
      "EquipTrack/5.png?auto=format&fit=crop&w=1400&q=80",
      "EquipTrack/6.png?auto=format&fit=crop&w=1400&q=80",
      "EquipTrack/7.png?auto=format&fit=crop&w=1400&q=80",
      "EquipTrack/8.png?auto=format&fit=crop&w=1400&q=80",
    ],
    link: "https://nadhir.dev/projects/deploy-kit",
  },
  {
    id: "mindlink",
    category: "Platform",
    title: "MindLink",
    description: "Your personalized companion for smarter learning.",
    subtitle: "A student-focused platform that provides personalized study tools, task management, and real-time academic support to boost productivity and learning outcomes.",
    details:
      "MindLink is an innovative student helper app designed to support learners by providing personalized study tools, resources, and real-time assistance. It offers features like task management, study reminders, and interactive learning aids, empowering students to enhance their productivity and academic success.",
    tags: ["HTML", "CSS", "JavaScript", "PHP", "MYSQL"],
    timeline: "October 2025",
    role: "Mobile & Web",
    image: "MindLink/Login.png?auto=format&fit=crop&w=1200&q=80",
    gallery: [
      "MindLink/1.png?auto=format&fit=crop&w=1400&q=80",
      "MindLink/2.png?auto=format&fit=crop&w=1400&q=80",
      "MindLink/3.png?auto=format&fit=crop&w=1400&q=80",
      "MindLink/4.png?auto=format&fit=crop&w=1400&q=80",
      "MindLink/5.png?auto=format&fit=crop&w=1400&q=80",
      "MindLink/6.png?auto=format&fit=crop&w=1400&q=80",
      "MindLink/7.png?auto=format&fit=crop&w=1400&q=80",
      "MindLink/8.png?auto=format&fit=crop&w=1400&q=80",
      "MindLink/9.png?auto=format&fit=crop&w=1400&q=80",
    ],
    link: "https://walran207.github.io/PortfolioV2/projects.html",
  },
  {
    id: "reneweco",
    category: "Platform",
    title: "RenewEco",
    description: "A mobile and web-based platform that helps cities and municipalities schedule waste collection, manage customer data, and track services in real time for improved efficiency and public satisfaction.",
    subtitle: "Smart solutions for efficient and sustainable waste management.",
    details:
      "Renew Eco is a specialized system designed to assist municipalities and cities in scheduling waste collection and efficiently tracking customer information. It streamlines garbage management, ensuring timely pickups and providing real-time tracking for improved service delivery and customer satisfaction.",
    tags: ["Flutterflow", "Dart", "Firebase"],
    timeline: "March 2025",
    role: "Mobile & Web",
    image: "RenewEco/Login.png?auto=format&fit=crop&w=1200&q=80",
    gallery: [
      "RenewEco/1.png?auto=format&fit=crop&w=1400&q=80",
      "RenewEco/2.png?auto=format&fit=crop&w=1400&q=80",
      "RenewEco/3.png?auto=format&fit=crop&w=1400&q=80",
      "RenewEco/4.png?auto=format&fit=crop&w=1400&q=80",
      "RenewEco/5.png?auto=format&fit=crop&w=1400&q=80",
      "RenewEco/6.png?auto=format&fit=crop&w=1400&q=80",
    ],
    link: "https://walran207.github.io/PortfolioV2/projects.html",
  },
  {
    id: "styleTransfer",
    category: "Platform",
    title: "NeuralStyleTransfer",
    description: "A mobile-based platform that uses neural networks to apply artistic styles to images in real time, enabling users to instantly create visually stunning artworks on the go.",
    subtitle: "Transform photos into art with real-time neural styling.",
    details:
      "Mobile-based Real-Time Neural Style Transfer is an innovative system that leverages advanced neural networks to apply artistic styles to images in real time. With seamless mobile integration, users can instantly transform their photos into unique artworks, enhancing creativity on the go.",
    tags: ["Flutterflow", "Dart", "Firebase"],
    timeline: "March 2025",
    role: "Mobile Development",
    image: "StyleTransfer/mosaic.png?auto=format&fit=crop&w=1200&q=80",
    gallery: [
      "StyleTransfer/1.png??auto=format&fit=crop&w=1400&q=80",
      "StyleTransfer/2.png??auto=format&fit=crop&w=1400&q=80",
      "StyleTransfer/3.png??auto=format&fit=crop&w=1400&q=80",
      "StyleTransfer/4.png??auto=format&fit=crop&w=1400&q=80",
      "StyleTransfer/5.png??auto=format&fit=crop&w=1400&q=80",
      "StyleTransfer/6.png??auto=format&fit=crop&w=1400&q=80",
      "StyleTransfer/7.png??auto=format&fit=crop&w=1400&q=80",
    ],
    link: "https://walran207.github.io/PortfolioV2/projects.html",
  },

  {
    id: "automatedemail",
    category: "Automation",
    title: "Automated Email Receipt Capture",
    description: "A streamlined automation solution integrating Email by Zapier, OpenAI, Google Sheets, and Slack that intelligently captures receipts from email, extracts key financial details using AI, logs expenses to a centralized budget tracker, and delivers real-time notifications to your team.",
    subtitle: "Intelligent expense management that automatically captures receipts, extracts details with AI, and logs them to your budget tracker.",
    details:
      "This enterprise-level expense management automation eliminates manual receipt tracking and reduces data entry overhead by capturing incoming receipt emails to a dedicated user-specific inbox, intelligently filtering for expense-related content (amount, total, receipt, invoice, purchase, cost), and extracting key transaction details using OpenAI GPT-4o-mini AI language processing. The workflow automatically logs structured expense data to Google Sheets for centralized budget analysis and reporting, then notifies your operations team via Slack with complete transaction summaries and categorization. The system ensures consistent data flow across platforms and eliminates gaps in expense tracking processes.",
    tags: ["Zapier", "Google Sheets", "Slack", "OpenAI"],
    timeline: "JANUARY 2026",
    role: "Automation Workflow",
    image: "Budget/1.png?auto=format&fit=crop&w=1200&q=80",
    gallery: [
      "Budget/1.png??auto=format&fit=crop&w=1400&q=80",
      "Budget/budget.mp4??auto=format&fit=crop&w=1400&q=80"
    ],
    link: "https://walran207.github.io/PortfolioV2/projects.html",
  },
  {
    id: "automatedrepurposing",
    category: "Automation",
    title: "Automated Audio-to-Multi-Platform Content Distribution",
    description: "The system automatically detects new mp3 files uploaded to Google Drive, transcribes the audio using AssemblyAI, generates two distinct SEO-optimized blog posts with accompanying social media posts using AI (GPT-4o-mini), logs all content to Google Sheets for tracking, and publishes to Instagram, LinkedIn, and Ghost simultaneously with a Slack notification to your team.",
    subtitle: "Transform audio files into SEO-optimized blog posts and distribute them across Instagram, LinkedIn, Ghost, and Google Sheets automatically.",
    details:
      "This enterprise-level content automation workflow eliminates manual transcription and content creation bottlenecks by capturing new audio files from Google Drive, intelligently filtering for mp3 files, and transcribing them using AssemblyAI's speech-to-text API. The workflow leverages OpenAI's GPT-4o-mini AI language model to generate two professionally-written blog posts with SEO-optimized headlines, structured body content, actionable conclusions, and key takeaways—all complete with platform-specific social media posts (Instagram and LinkedIn versions). The system logs all generated content to Google Sheets for centralized content management and reporting, then simultaneously publishes Blog Post #1 to Instagram and LinkedIn via Path A, while Publishing Blog Post #2 to Ghost CMS and notifying your content team via Slack in Path B. The intelligent validation filter ensures only quality content (non-empty headlines and body text) proceeds through the publishing pipeline, maintaining consistency across all platforms and eliminating gaps in your content distribution process.",
    tags: ["Google Drive","Assembly AI", "Google Sheets", "Slack", "OpenAI","Instagram","LinkedIn","Ghost CMS"],
    timeline: "JANUARY 2026",
    role: "Automation Workflow",
    image: "Reporpusing/1.png??auto=format&fit=crop&w=1400&q=80",
    gallery: [
      "Reporpusing/1.png??auto=format&fit=crop&w=1400&q=80",
      "Reporpusing/2.png??auto=format&fit=crop&w=1400&q=80",
      "Reporpusing/3.png??auto=format&fit=crop&w=1400&q=80",
      "Reporpusing/reporpusing.mp4??auto=format&fit=crop&w=1400&q=80"
    ],
    link: "https://walran207.github.io/PortfolioV2/projects.html",
  },
  {
    id: "automatedcourse",
    category: "Automation",
    title: "Zapier Course Registration Automation with student Onboarding",
    description: "The system automatically captures student registrations from JotForm, creates contact records in ClickFunnels, enrolls students in courses, manages email list segmentation, sends personalized welcome communications with scheduling links, and provides real-time team notifications via Slack.",
    subtitle: "Streamline student registrations across ClickFunnels, ActiveCampaign, Gmail, and Slack with zero manual intervention.",
    details:
      "This enterprise-level course registration automation eliminates manual enrollment processes and reduces administrative overhead by capturing incoming registration submissions from JotForm, automatically creating and updating student contact records in ClickFunnels CRM, and immediately enrolling them in designated courses. The workflow syncs student data across your email marketing platform by adding contacts to segmented lists in ActiveCampaign and applying campaign-specific tags for targeted follow-up. Personalized welcome emails are automatically sent via Gmail with embedded Calendly scheduling links to streamline student onboarding calls, while your operations team receives real-time Slack notifications with complete registration summaries. The system ensures consistent data flow across platforms and eliminates gaps in student enrollment processes.",
    tags: ["Jotform","ClickFunnels", "Google Sheets", "ActiveCampaign", "Gmail","Slack"],
    timeline: "JANUARY 2026",
    role: "Automation Workflow",
    image: "Course/1.png??auto=format&fit=crop&w=1400&q=80",
    gallery: [
      "Course/1.png??auto=format&fit=crop&w=1400&q=80",
      "Course/2.png??auto=format&fit=crop&w=1400&q=80",
      "Course/course.mp4??auto=format&fit=crop&w=1400&q=80"
    ],
    link: "https://walran207.github.io/PortfolioV2/projects.html",
  },
  {
    id: "automatedleadmanagement",
    category: "Automation",
    title: "Intelligent Lead Scoring & Automated Multi-Channel Nurture Workflow ",
    description: "The system captures lead submissions, uses AI to analyze and score lead quality, then automatically routes HIGH-tier prospects to your sales team while nurturing MEDIUM/LOW-tier leads through email sequences and centralized tracking.",
    subtitle: "Automatically qualify leads with AI analysis and route them to the right team based on quality tier.",
    details:
      "This intelligent lead management automation eliminates manual qualification bottlenecks by capturing incoming lead survey submissions from Typeform and leveraging OpenAI GPT-4o mini to instantly analyze lead quality across multiple dimensions (budget, timeline, company size, engagement level, and industry alignment). The workflow assigns a quality score (0-100) and tier classification (HIGH/MEDIUM/LOW) using structured AI assessment criteria. HIGH-tier prospects (75-100 score) trigger immediate action: real-time Slack notifications to your sales team, automatic contact creation in HubSpot with lead details, and personalized outreach emails via Gmail. MEDIUM and LOW-tier leads receive nurture emails and are logged to Zapier Tables for future campaign targeting and analysis. The system ensures consistent lead routing, eliminates manual review time, and provides real-time visibility into pipeline health across your entire technology stack.",
    tags: ["TypeForm","OpenAI", "Slack", "Hubspot", "Gmail","Tables"],
    timeline: "JANUARY 2026",
    role: "Automation Workflow",
    image: "LeadManagement/1.png??auto=format&fit=crop&w=1400&q=80",
    gallery: [
      "LeadManagement/1.png??auto=format&fit=crop&w=1400&q=80",
      "LeadManagement/2.png??auto=format&fit=crop&w=1400&q=80",
      "LeadManagement/LeadManagement.mp4??auto=format&fit=crop&w=1400&q=80"
    ],
    link: "https://walran207.github.io/PortfolioV2/projects.html",
  },

    {
    id: "automatedtools",
    category: "Automation",
    title: "Automated Tools Access Request & Approval Tracking System",
    description: "This workflow captures approval actions from a Table button click, updates the approval request record with status and timestamp, and instantly notifies your finance team via Slack with request details.",
    subtitle: "Automated approval tracking from Zapier Tables with instant team notifications via Slack.",
    details:
      "This approval automation streamlines your request management process by capturing button-click approvals directly from your Zapier Table, automatically updating the corresponding approval request record with Approved status and a precise timestamp. The system immediately notifies your finance team through Slack with complete request context, including the request amount and requester name, ensuring visibility across your organization. This eliminates manual status updates and email chains, creating a transparent, audit-ready approval trail while keeping stakeholders informed in real-time across your platforms.",
    tags: ["TypeForm","OpenAI", "Slack","Gmail","Tables"],
    timeline: "JANUARY 2026",
    role: "Automation Workflow",
    image: "Tools/1.png??auto=format&fit=crop&w=1400&q=80",
    gallery: [
      "Tools/1.png??auto=format&fit=crop&w=1400&q=80",
      "Tools/2.png??auto=format&fit=crop&w=1400&q=80",
      "Tools/3.png??auto=format&fit=crop&w=1400&q=80",
      "Tools/tools.mp4??auto=format&fit=crop&w=1400&q=80"
    ],
    link: "https://walran207.github.io/PortfolioV2/projects.html",
  },

];

function assetPath(path) {
  if (/^https?:\/\//i.test(path)) return path;
  const noQuery = path.split("?")[0];
  const trimmed = noQuery.replace(/^\/+/, "").replace(/\?\?/g, "?");
  if (trimmed.startsWith("public/")) return `./${trimmed}`;
  return `./public/${trimmed}`;
}

function elFromHTML(html) {
  const template = document.createElement("template");
  template.innerHTML = html.trim();
  return template.content.firstElementChild;
}

function renderProjectsGrid() {
  const grid = document.getElementById("projectsGrid");
  if (!grid) return;

  projects.forEach((project) => {
    const card = elFromHTML(`
      <div class="col-12 col-md-6">
        <button type="button" class="project-card w-100 text-start p-0" data-project-id="${project.id}">
          <div class="project-card-media">
            <img src="${assetPath(project.image)}" alt="${project.title} preview" loading="lazy" />
            <div class="project-card-over">
              <p class="text-white-60 small font-mono text-uppercase tracking-wide mb-2">${project.category}</p>
              <h3 class="h4 font-mono fw-bold text-white mb-2">${project.title}</h3>
              <p class="text-white-80 small mb-0">${project.description}</p>
            </div>
          </div>
          <div class="project-card-body">
            <div class="d-flex flex-wrap gap-2 mb-3">
              ${project.tags.map((tag) => `<span class="tag-pill">${tag}</span>`).join("")}
            </div>
            <div class="d-flex align-items-center gap-2 text-white-60 small font-mono">
              <span>${project.timeline}</span>
              <span class="mx-1" aria-hidden="true">•</span>
              <span>${project.role}</span>
            </div>
          </div>
        </button>
      </div>
    `);

    grid.appendChild(card);
  });
}

// Helper function to check if a file path is a video
function isVideo(path) {
  // Removes query parameters (like ?auto=format) before checking extension
  const cleanPath = path.split('?')[0];
  return /\.(mp4|webm|ogg|mov)$/i.test(cleanPath);
}

function setModalProject(project) {
  const modalEl = document.getElementById("projectModal");
  if (!modalEl) return;

  document.getElementById("projectModalCategory").textContent = project.category;
  document.getElementById("projectModalLabel").textContent = project.title;
  document.getElementById("projectModalSubtitle").textContent = project.subtitle;
  document.getElementById("projectModalTimeline").textContent = project.timeline;
  document.getElementById("projectModalRole").textContent = project.role;
  document.getElementById("projectModalDetails").textContent = project.details;

  const tagsWrap = document.getElementById("projectModalTags");
  tagsWrap.innerHTML = project.tags.map((tag) => `<span class="tag-pill">${tag}</span>`).join("");

  const linkWrap = document.getElementById("projectModalLinkWrap");
  const linkEl = document.getElementById("projectModalLink");

  // Determine slides
  const slides = (project.gallery?.length ? project.gallery : [project.image]).map(assetPath);
  const inner = document.getElementById("projectCarouselInner");
  const indicators = document.getElementById("projectCarouselIndicators");
  const prevBtn = document.getElementById("projectCarouselPrev");
  const nextBtn = document.getElementById("projectCarouselNext");
  
  inner.innerHTML = "";
  if (indicators) indicators.innerHTML = "";

  // Logic to handle both Images and Videos
  slides.forEach((src, idx) => {
    let mediaContent = "";

    if (isVideo(src)) {
      // If it's a video, use the <video> tag
      mediaContent = `
        <div class="video-container" style="background: #000; border-radius: 1rem; overflow: hidden;">
          <video src="${src}" controls class="w-100" style="max-height: 46vh; display: block;">
            Your browser does not support the video tag.
          </video>
        </div>`;
    } else {
      // If it's an image, keep your existing zoom button and <img> tag
      mediaContent = `
        <button type="button" class="carousel-zoom-btn" data-zoom-index="${idx}" aria-label="Zoom image ${idx + 1}">
          <img src="${src}" alt="${project.title} screen ${idx + 1}" loading="lazy" />
        </button>`;
    }

    const item = elFromHTML(`
      <div class="carousel-item ${idx === 0 ? "active" : ""}">
        ${mediaContent}
      </div>
    `);
    inner.appendChild(item);
  });

  const carouselEl = document.getElementById("projectCarousel");
  const carousel = bootstrap.Carousel.getOrCreateInstance(carouselEl, {
    interval: false,
    ride: false,
    touch: true,
    keyboard: true,
  });
  carousel.to(0);

  if (indicators) {
    slides.forEach((_, idx) => {
      const button = document.createElement("button");
      button.type = "button";
      button.setAttribute("aria-label", `Slide ${idx + 1}`);
      if (idx === 0) {
        button.classList.add("active");
        button.setAttribute("aria-current", "true");
      }
      button.addEventListener("click", () => carousel.to(idx));
      indicators.appendChild(button);
    });
  }

  const updateIndicators = (activeIndex) => {
    if (!indicators) return;
    Array.from(indicators.querySelectorAll("button")).forEach((btn, idx) => {
      btn.classList.toggle("active", idx === activeIndex);
      if (idx === activeIndex) btn.setAttribute("aria-current", "true");
      else btn.removeAttribute("aria-current");
    });
  };

  if (carouselEl.__onSlide) {
    carouselEl.removeEventListener("slid.bs.carousel", carouselEl.__onSlide);
  }
  carouselEl.__onSlide = (event) => updateIndicators(event.to ?? 0);
  carouselEl.addEventListener("slid.bs.carousel", carouselEl.__onSlide);

  if (prevBtn) prevBtn.onclick = () => carousel.prev();
  if (nextBtn) nextBtn.onclick = () => carousel.next();

  // Re-attach zoom events only to images (skipping videos)
  inner.querySelectorAll(".carousel-zoom-btn").forEach((btn) => {
    btn.addEventListener("click", () => openZoomModal(slides, Number(btn.getAttribute("data-zoom-index") || 0)));
  });
}

function openZoomModal(slides, startIndex) {
  const modalEl = document.getElementById("zoomModal");
  const inner = document.getElementById("zoomCarouselInner");
  const indicators = document.getElementById("zoomCarouselIndicators");
  const prevBtn = document.getElementById("zoomCarouselPrev");
  const nextBtn = document.getElementById("zoomCarouselNext");
  
  inner.innerHTML = "";
  if (indicators) indicators.innerHTML = "";

  slides.forEach((src, idx) => {
    let mediaHtml = "";

    if (isVideo(src)) {
      // Logic for Video in Zoom View
      mediaHtml = `
        <video src="${src}" controls class="w-100" style="max-height: 80vh; border-radius: 1rem; outline: none;">
          Your browser does not support the video tag.
        </video>`;
    } else {
      // Logic for Image in Zoom View
      mediaHtml = `
        <img src="${src}" alt="Zoomed project visual" class="w-100" style="max-height: 70vh; object-fit: contain; border-radius: 1rem;" />`;
    }

    const item = elFromHTML(`
      <div class="carousel-item ${idx === startIndex ? "active" : ""}">
        <div class="d-flex justify-content-center align-items-center bg-black rounded-4 p-2">
          ${mediaHtml}
        </div>
      </div>
    `);
    inner.appendChild(item);
  });

  const carouselEl = document.getElementById("zoomCarousel");
  const carousel = bootstrap.Carousel.getOrCreateInstance(carouselEl, {
    interval: false,
    ride: false,
    touch: true,
    keyboard: true,
  });
  carousel.to(startIndex);

  if (indicators) {
    slides.forEach((_, idx) => {
      const button = document.createElement("button");
      button.type = "button";
      button.setAttribute("aria-label", `Slide ${idx + 1}`);
      if (idx === startIndex) {
        button.classList.add("active");
        button.setAttribute("aria-current", "true");
      }
      button.addEventListener("click", () => carousel.to(idx));
      indicators.appendChild(button);
    });
  }

  const updateIndicators = (activeIndex) => {
    if (!indicators) return;
    Array.from(indicators.querySelectorAll("button")).forEach((btn, idx) => {
      btn.classList.toggle("active", idx === activeIndex);
      if (idx === activeIndex) btn.setAttribute("aria-current", "true");
      else btn.removeAttribute("aria-current");
    });
  };

  if (carouselEl.__onSlide) {
    carouselEl.removeEventListener("slid.bs.carousel", carouselEl.__onSlide);
  }
  carouselEl.__onSlide = (event) => updateIndicators(event.to ?? startIndex);
  carouselEl.addEventListener("slid.bs.carousel", carouselEl.__onSlide);

  if (prevBtn) prevBtn.onclick = () => carousel.prev();
  if (nextBtn) nextBtn.onclick = () => carousel.next();

  const modal = bootstrap.Modal.getOrCreateInstance(modalEl);
  modal.show();
}

function setupProjectClicks() {
  document.addEventListener("click", (event) => {
    const button = event.target.closest("[data-project-id]");
    if (!button) return;
    const project = projects.find((p) => p.id === button.getAttribute("data-project-id"));
    if (!project) return;

    setModalProject(project);
    const modal = bootstrap.Modal.getOrCreateInstance(document.getElementById("projectModal"));
    modal.show();
  });
}

document.addEventListener("DOMContentLoaded", () => {
  renderProjectsGrid();
  setupProjectClicks();
});
